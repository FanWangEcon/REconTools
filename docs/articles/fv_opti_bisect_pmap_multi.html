<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OPTI BISECT--Solve Roots for N (Rows) Strictly Monotonic Functions with Single Zero-Crossing • REconTools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="OPTI BISECT--Solve Roots for N (Rows) Strictly Monotonic Functions with Single Zero-Crossing">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-92953468-5"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-92953468-5');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">REconTools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/fv_dist_gini_vector_pos.html">DIST GINI--Compute Gini Inequality Coefficient Given Data Vector (One Variable)</a>
    </li>
    <li>
      <a href="../articles/fv_opti_bisect_pmap_multi.html">OPTI BISECT--Solve Roots for N (Rows) Strictly Monotonic Functions with Single Zero-Crossing</a>
    </li>
    <li>
      <a href="../articles/fv_panel_cumsum_grouplast.html">PANEL CUMSUM LAST--Cumulative Sum by Index Up to Last in Group</a>
    </li>
    <li>
      <a href="../articles/fv_panel_expand_longandwide.html">PANEL EXPAND--Append Group Mean Lagged Values as Additional Panel Variables</a>
    </li>
    <li>
      <a href="../articles/fv_summ_bygroup.html">SUMM BYGROUP--Summarize Variable by Factor Groups</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="fv_opti_bisect_pmap_multi_files/kePrint-0.0.1/kePrint.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>OPTI BISECT–Solve Roots for N (Rows) Strictly Monotonic Functions with Single Zero-Crossing</h1>
            
      
      
      <div class="hidden name"><code>fv_opti_bisect_pmap_multi.Rmd</code></div>

    </div>

    
    
<p>Back to <strong><a href="https://fanwangecon.github.io/">Fan</a></strong>’s REconTools <strong><a href="https://fanwangecon.github.io/REconTools/">Table of Content</a></strong>. Also see <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a> for R examples and <a href="https://fanwangecon.github.io/Stat4Econ/">Intro Stats with R</a> for R introductions.</p>
<div id="objective" class="section level1">
<h1 class="hasAnchor">
<a href="#objective" class="anchor"></a>Objective</h1>
<p>This file works out how the <a href="https://fanwangecon.github.io/REconTools/reference/ff_opti_bisect_pmap_multi.html">ff_opti_bisect_pmap_multi</a> function works from <a href="https://fanwangecon.github.io/">Fan</a>’s <em><a href="https://fanwangecon.github.io/REconTools/">REconTools</a></em> Package. Also see a closely related file from <a href="https://fanwangecon.github.io/R4Econ/">R4Econ</a>, <a href="https://fanwangecon.github.io/R4Econ/optimization/root_bisect/fs_func_graph_eval.html">DPLYR Bisection</a>, which works out in greater detail the bisection algorithm.</p>
<p>We want solve for function <span class="math inline">\(0=f(z_{ij}, x_i, y_i, \textbf{X}, \textbf{Y}, c, d)\)</span>. There are <span class="math inline">\(i\)</span> functions that have <span class="math inline">\(i\)</span> specific <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>. For each <span class="math inline">\(i\)</span> function, we evaluate along a grid of feasible values for <span class="math inline">\(z\)</span>, over <span class="math inline">\(j\in J\)</span> grid points, potentially looking for the <span class="math inline">\(j\)</span> that is closest to the root. <span class="math inline">\(j\)</span> could be interpreted as iterations. <span class="math inline">\(\textbf{X}\)</span> and <span class="math inline">\(\textbf{Y}\)</span> are arrays common across the <span class="math inline">\(i\)</span> equations, and <span class="math inline">\(c\)</span> and <span class="math inline">\(d\)</span> are constants.</p>
<p>As we iterate over <span class="math inline">\(j\)</span>, find the <span class="math inline">\(z_{ij}\)</span> that is <span class="math inline">\(i\)</span> specific that allows for <span class="math inline">\(f_{i}(z_{ij})=0\)</span>.</p>
<p>In the code below, we develop the bisection code line by line, then we write it as a function using pmap. At the end, we test the concurrent bisection code over tibble dataframe with a set of straight lines (negative intercepts and positive slopes), and the log-linear solution for optimal allocation function from <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/PrjOptiAlloc/">PrjOptiAlloc</a> Project.</p>
<div id="bisection-algorithm" class="section level2">
<h2 class="hasAnchor">
<a href="#bisection-algorithm" class="anchor"></a>Bisection Algorithm</h2>
<p>This is how I implement the bisection algorithm, when we know the bounding minimum and maximum to be below and above zero already.</p>
<ol style="list-style-type: decimal">
<li>Evaluate <span class="math inline">\(f^0_a = f(a^0)\)</span> and <span class="math inline">\(f^0_b = f(b^0)\)</span>, min and max points.</li>
<li>Evaluate at <span class="math inline">\(f^0_p = f(p^0)\)</span>, where <span class="math inline">\(p_0 = \frac{a^0+b^0}{2}\)</span>.</li>
<li>if <span class="math inline">\(f^i_a \cdot f^i_p &lt; 0\)</span>, then <span class="math inline">\(b_{i+1} = p_i\)</span>, else, <span class="math inline">\(a_{i+1} = p_i\)</span> and <span class="math inline">\(f^{i+1}_a = p_i\)</span>.</li>
<li>iteratre until convergence.</li>
</ol>
<p>And for the function we want to bisect over, as stated earlier, it has three types of variables:</p>
<ol style="list-style-type: decimal">
<li>variables in file for grouping, each group is an individual for whom we want to calculate optimal choice for using bisection.</li>
<li>variables that change each row and each iteration, the root we are looking for.</li>
<li>scalar and array values that are applied to every row and persist across iterations.</li>
</ol>
</div>
</div>
<div id="set-up-for-implementation" class="section level1">
<h1 class="hasAnchor">
<a href="#set-up-for-implementation" class="anchor"></a>Set up for Implementation</h1>
<p>Invoking the algorithm uses several key tidyverse functions:</p>
<ol style="list-style-type: decimal">
<li>
<em>pmap</em> from <a href="https://purrr.tidyverse.org/index.html">purrr</a> to evaluate function row by row.</li>
<li>
<em>case_when</em> from <a href="https://dplyr.tidyverse.org/reference/case_when.html">dplyr</a> to set new lower and upper bound.</li>
<li>
<em>pivot_wider</em> and <em>pivot_longer</em> from <a href="https://tidyr.tidyverse.org/index.html">tidyr</a> to reshape resulting file if record all iteration results.</li>
</ol>
<div id="load-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#load-packages" class="anchor"></a>Load Packages</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="dt">list =</span> <span class="kw"><a href="https://rdrr.io/r/base/ls.html">ls</a></span>(<span class="dt">all.names =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tibble)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidyr)</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(purrr)</a>
<a class="sourceLine" id="cb1-5" title="5"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb1-6" title="6"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(knitr)</a>
<a class="sourceLine" id="cb1-7" title="7"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb1-8" title="8"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(kableExtra)</a></code></pre></div>
</div>
<div id="set-up-input-arrays" class="section level2">
<h2 class="hasAnchor">
<a href="#set-up-input-arrays" class="anchor"></a>Set up Input Arrays</h2>
<p>There is a function that takes <span class="math inline">\(M=Q+P\)</span> inputs, we want to evaluate this function <span class="math inline">\(N\)</span> times. Each time, there are <span class="math inline">\(M\)</span> inputs, where all but <span class="math inline">\(Q\)</span> of the <span class="math inline">\(M\)</span> inputs, meaning <span class="math inline">\(P\)</span> of the <span class="math inline">\(M\)</span> inputs, are the same. In particular, <span class="math inline">\(P=Q*N\)</span>.</p>
<p><span class="math display">\[M = Q+P = Q + Q*N\]</span></p>
<p>Now we need to expand this by the number of choice grid. Each row, representing one equation, is expanded by the number of choice grids. We are graphically searching, or rather brute force searching, which means if we have 100 individuals, we want to plot out the nonlinear equation for each of these lines, and show graphically where each line crosses zero. We achieve this, by evaluating the equation for each of the 100 individuals along a grid of feasible choices.</p>
<p>In this problem here, the feasible choices are shared across individuals.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="co"># Parameters</span></a>
<a class="sourceLine" id="cb2-2" title="2">fl_rho =<span class="st"> </span><span class="fl">0.20</span></a>
<a class="sourceLine" id="cb2-3" title="3">svr_id_var =<span class="st"> 'INDI_ID'</span></a>
<a class="sourceLine" id="cb2-4" title="4"></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="co"># it_child_count = N, the number of children</span></a>
<a class="sourceLine" id="cb2-6" title="6">it_N_child_cnt =<span class="st"> </span><span class="dv">9</span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="co"># it_heter_param = Q, number of parameters that are heterogeneous across children</span></a>
<a class="sourceLine" id="cb2-8" title="8">it_Q_hetpa_cnt =<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb2-9" title="9"></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="co"># P fixed parameters, nN is N dimensional, nP is P dimensional</span></a>
<a class="sourceLine" id="cb2-11" title="11">ar_nN_A =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dt">length.out =</span> it_N_child_cnt)</a>
<a class="sourceLine" id="cb2-12" title="12">ar_nN_alpha =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="dt">length.out =</span> it_N_child_cnt)</a>
<a class="sourceLine" id="cb2-13" title="13">ar_nP_A_alpha =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(ar_nN_A, ar_nN_alpha)</a>
<a class="sourceLine" id="cb2-14" title="14"></a>
<a class="sourceLine" id="cb2-15" title="15"><span class="co"># N by Q varying parameters</span></a>
<a class="sourceLine" id="cb2-16" title="16">mt_nN_by_nQ_A_alpha =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(ar_nN_A, ar_nN_alpha)</a>
<a class="sourceLine" id="cb2-17" title="17"></a>
<a class="sourceLine" id="cb2-18" title="18"><span class="co"># Choice Grid for nutritional feasible choices for each</span></a>
<a class="sourceLine" id="cb2-19" title="19">fl_N_agg =<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb2-20" title="20">fl_N_min =<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb2-21" title="21"></a>
<a class="sourceLine" id="cb2-22" title="22"><span class="co"># Mesh Expand</span></a>
<a class="sourceLine" id="cb2-23" title="23">tb_states_choices &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(mt_nN_by_nQ_A_alpha) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rowid_to_column</span>(<span class="dt">var=</span>svr_id_var)</a>
<a class="sourceLine" id="cb2-24" title="24">ar_st_col_names =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(svr_id_var,<span class="st">'fl_A'</span>, <span class="st">'fl_alpha'</span>)</a>
<a class="sourceLine" id="cb2-25" title="25">tb_states_choices &lt;-<span class="st"> </span>tb_states_choices <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename_all</span>(<span class="op">~</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(ar_st_col_names))</a>
<a class="sourceLine" id="cb2-26" title="26"></a>
<a class="sourceLine" id="cb2-27" title="27"><span class="co"># display</span></a>
<a class="sourceLine" id="cb2-28" title="28"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(tb_states_choices)</a></code></pre></div>
<pre><code>##     INDI_ID       fl_A       fl_alpha  
##  Min.   :1   Min.   :-2   Min.   :0.1  
##  1st Qu.:3   1st Qu.:-1   1st Qu.:0.3  
##  Median :5   Median : 0   Median :0.5  
##  Mean   :5   Mean   : 0   Mean   :0.5  
##  3rd Qu.:7   3rd Qu.: 1   3rd Qu.:0.7  
##  Max.   :9   Max.   : 2   Max.   :0.9</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">kable</span>(tb_states_choices) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="st">  </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>, <span class="st">"responsive"</span>))</a></code></pre></div>
<table class="table table table-striped table-hover table-condensed table-responsive">
<thead><tr>
<th style="text-align:right;">
INDI_ID
</th>
<th style="text-align:right;">
fl_A
</th>
<th style="text-align:right;">
fl_alpha
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-2.0
</td>
<td style="text-align:right;">
0.1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-1.5
</td>
<td style="text-align:right;">
0.2
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
-1.0
</td>
<td style="text-align:right;">
0.3
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
-0.5
</td>
<td style="text-align:right;">
0.4
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0.5
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.6
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
0.7
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
1.5
</td>
<td style="text-align:right;">
0.8
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
2.0
</td>
<td style="text-align:right;">
0.9
</td>
</tr>
</tbody>
</table>
</div>
<div id="create-nonlinear-root-function" class="section level2">
<h2 class="hasAnchor">
<a href="#create-nonlinear-root-function" class="anchor"></a>Create Nonlinear Root Function</h2>
<p>These is a test functions over which we will searh for roots.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co"># Define Implicit Function</span></a>
<a class="sourceLine" id="cb5-2" title="2">ffi_nonlin_dplyrdo &lt;-<span class="st"> </span><span class="cf">function</span>(fl_A, fl_alpha, fl_N, ar_A, ar_alpha, fl_N_agg, fl_rho){</a>
<a class="sourceLine" id="cb5-3" title="3">  <span class="co"># scalar value that are row-specific, in dataframe already: *fl_A*, *fl_alpha*, *fl_N*</span></a>
<a class="sourceLine" id="cb5-4" title="4">  <span class="co"># array and scalars not in dataframe, common all rows: *ar_A*, *ar_alpha*, *fl_N_agg*, *fl_rho*</span></a>
<a class="sourceLine" id="cb5-5" title="5"></a>
<a class="sourceLine" id="cb5-6" title="6">  <span class="co"># Test Parameters</span></a>
<a class="sourceLine" id="cb5-7" title="7">  <span class="co"># ar_A = ar_nN_A</span></a>
<a class="sourceLine" id="cb5-8" title="8">  <span class="co"># ar_alpha = ar_nN_alpha</span></a>
<a class="sourceLine" id="cb5-9" title="9">  <span class="co"># fl_N = 100</span></a>
<a class="sourceLine" id="cb5-10" title="10">  <span class="co"># fl_rho = -1</span></a>
<a class="sourceLine" id="cb5-11" title="11">  <span class="co"># fl_N_q = 10</span></a>
<a class="sourceLine" id="cb5-12" title="12"></a>
<a class="sourceLine" id="cb5-13" title="13">  <span class="co"># Apply Function</span></a>
<a class="sourceLine" id="cb5-14" title="14">  ar_p1_s1 =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>((fl_A <span class="op">-</span><span class="st"> </span>ar_A)<span class="op">*</span>fl_rho)</a>
<a class="sourceLine" id="cb5-15" title="15">  ar_p1_s2 =<span class="st"> </span>(fl_alpha<span class="op">/</span>ar_alpha)</a>
<a class="sourceLine" id="cb5-16" title="16">  ar_p1_s3 =<span class="st"> </span>(<span class="dv">1</span><span class="op">/</span>(ar_alpha<span class="op">*</span>fl_rho <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb5-17" title="17">  ar_p1 =<span class="st"> </span>(ar_p1_s1<span class="op">*</span>ar_p1_s2)<span class="op">^</span>ar_p1_s3</a>
<a class="sourceLine" id="cb5-18" title="18">  ar_p2 =<span class="st"> </span>fl_N<span class="op">^</span>((fl_alpha<span class="op">*</span>fl_rho<span class="dv">-1</span>)<span class="op">/</span>(ar_alpha<span class="op">*</span>fl_rho<span class="dv">-1</span>))</a>
<a class="sourceLine" id="cb5-19" title="19">  ar_overall =<span class="st"> </span>ar_p1<span class="op">*</span>ar_p2</a>
<a class="sourceLine" id="cb5-20" title="20">  fl_overall =<span class="st"> </span>fl_N_agg <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(ar_overall)</a>
<a class="sourceLine" id="cb5-21" title="21"></a>
<a class="sourceLine" id="cb5-22" title="22">  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(fl_overall)</a>
<a class="sourceLine" id="cb5-23" title="23">}</a></code></pre></div>
</div>
</div>
<div id="step-by-step-implmentation-of-algorithm" class="section level1">
<h1 class="hasAnchor">
<a href="#step-by-step-implmentation-of-algorithm" class="anchor"></a>Step by Step Implmentation of Algorithm</h1>
<p>Generate New columns of a and b as we iteratre, do not need to store p, p is temporary. Evaluate the function below which we have already tested, but now, in the dataframe before generating all permutations, <em>tb_states_choices</em>, now the <em>fl_N</em> element will be changing with each iteration, it will be row specific. <em>fl_N</em> are first min and max, then each subsequent ps.</p>
<div id="initialize-matrix" class="section level2">
<h2 class="hasAnchor">
<a href="#initialize-matrix" class="anchor"></a>Initialize Matrix</h2>
<p>First, initialize the matrix with <span class="math inline">\(a_0\)</span> and <span class="math inline">\(b_0\)</span>, the initial min and max points:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="co"># common prefix to make reshaping easier</span></a>
<a class="sourceLine" id="cb6-2" title="2">st_bisec_prefix &lt;-<span class="st"> 'bisec_'</span></a>
<a class="sourceLine" id="cb6-3" title="3">svr_a_lst &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(st_bisec_prefix, <span class="st">'a_0'</span>)</a>
<a class="sourceLine" id="cb6-4" title="4">svr_b_lst &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(st_bisec_prefix, <span class="st">'b_0'</span>)</a>
<a class="sourceLine" id="cb6-5" title="5">svr_fa_lst &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(st_bisec_prefix, <span class="st">'fa_0'</span>)</a>
<a class="sourceLine" id="cb6-6" title="6">svr_fb_lst &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(st_bisec_prefix, <span class="st">'fb_0'</span>)</a>
<a class="sourceLine" id="cb6-7" title="7"></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="co"># Add initial a and b</span></a>
<a class="sourceLine" id="cb6-9" title="9">tb_states_choices_bisec &lt;-<span class="st"> </span>tb_states_choices <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="st">                            </span><span class="kw">mutate</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_a_lst) <span class="op">:</span><span class="er">=</span><span class="st"> </span>fl_N_min, <span class="op">!!</span><span class="kw">sym</span>(svr_b_lst) <span class="op">:</span><span class="er">=</span><span class="st"> </span>fl_N_agg)</a>
<a class="sourceLine" id="cb6-11" title="11"></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="co"># Evaluate function f(a_0) and f(b_0)</span></a>
<a class="sourceLine" id="cb6-13" title="13">tb_states_choices_bisec &lt;-<span class="st"> </span>tb_states_choices_bisec <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-14" title="14"><span class="st">                            </span><span class="kw">mutate</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_fa_lst) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">ffi_nonlin_dplyrdo</span>(fl_A, fl_alpha, <span class="op">!!</span><span class="kw">sym</span>(svr_a_lst),</a>
<a class="sourceLine" id="cb6-15" title="15">                                                                          ar_nN_A, ar_nN_alpha,</a>
<a class="sourceLine" id="cb6-16" title="16">                                                                          fl_N_agg, fl_rho),</a>
<a class="sourceLine" id="cb6-17" title="17">                                   <span class="op">!!</span><span class="kw">sym</span>(svr_fb_lst) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">ffi_nonlin_dplyrdo</span>(fl_A, fl_alpha, <span class="op">!!</span><span class="kw">sym</span>(svr_b_lst),</a>
<a class="sourceLine" id="cb6-18" title="18">                                                                          ar_nN_A, ar_nN_alpha,</a>
<a class="sourceLine" id="cb6-19" title="19">                                                                          fl_N_agg, fl_rho))</a>
<a class="sourceLine" id="cb6-20" title="20"><span class="co"># Summarize</span></a>
<a class="sourceLine" id="cb6-21" title="21"><span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(tb_states_choices_bisec)</a></code></pre></div>
<pre><code>## [1] 9 7</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(tb_states_choices_bisec)</a></code></pre></div>
<pre><code>##     INDI_ID       fl_A       fl_alpha     bisec_a_0   bisec_b_0     bisec_fa_0 
##  Min.   :1   Min.   :-2   Min.   :0.1   Min.   :0   Min.   :100   Min.   :100  
##  1st Qu.:3   1st Qu.:-1   1st Qu.:0.3   1st Qu.:0   1st Qu.:100   1st Qu.:100  
##  Median :5   Median : 0   Median :0.5   Median :0   Median :100   Median :100  
##  Mean   :5   Mean   : 0   Mean   :0.5   Mean   :0   Mean   :100   Mean   :100  
##  3rd Qu.:7   3rd Qu.: 1   3rd Qu.:0.7   3rd Qu.:0   3rd Qu.:100   3rd Qu.:100  
##  Max.   :9   Max.   : 2   Max.   :0.9   Max.   :0   Max.   :100   Max.   :100  
##    bisec_fb_0      
##  Min.   :-24328.4  
##  1st Qu.: -4157.8  
##  Median : -1386.7  
##  Mean   : -4737.0  
##  3rd Qu.:  -538.0  
##  Max.   :  -202.9</code></pre>
</div>
<div id="iterate-and-solve-for-fp-update-fa-and-fb" class="section level2">
<h2 class="hasAnchor">
<a href="#iterate-and-solve-for-fp-update-fa-and-fb" class="anchor"></a>Iterate and Solve for f(p), update f(a) and f(b)</h2>
<p>Implement the DPLYR based Concurrent bisection algorithm.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="co"># fl_tol = float tolerance criteria</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="co"># it_tol = number of interations to allow at most</span></a>
<a class="sourceLine" id="cb10-3" title="3">fl_tol &lt;-<span class="st"> </span><span class="dv">10</span><span class="op">^-</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb10-4" title="4">it_tol &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb10-5" title="5"></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="co"># fl_p_dist2zr = distance to zero to initalize</span></a>
<a class="sourceLine" id="cb10-7" title="7">fl_p_dist2zr &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb10-8" title="8">it_cur &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb10-9" title="9"><span class="cf">while</span> (it_cur <span class="op">&lt;=</span><span class="st"> </span>it_tol <span class="op">&amp;&amp;</span><span class="st"> </span>fl_p_dist2zr <span class="op">&gt;=</span><span class="st"> </span>fl_tol ) {</a>
<a class="sourceLine" id="cb10-10" title="10"></a>
<a class="sourceLine" id="cb10-11" title="11">  it_cur &lt;-<span class="st"> </span>it_cur <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb10-12" title="12"></a>
<a class="sourceLine" id="cb10-13" title="13">  <span class="co"># New Variables</span></a>
<a class="sourceLine" id="cb10-14" title="14">  svr_a_cur &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(st_bisec_prefix, <span class="st">'a_'</span>, it_cur)</a>
<a class="sourceLine" id="cb10-15" title="15">  svr_b_cur &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(st_bisec_prefix, <span class="st">'b_'</span>, it_cur)</a>
<a class="sourceLine" id="cb10-16" title="16">  svr_fa_cur &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(st_bisec_prefix, <span class="st">'fa_'</span>, it_cur)</a>
<a class="sourceLine" id="cb10-17" title="17">  svr_fb_cur &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(st_bisec_prefix, <span class="st">'fb_'</span>, it_cur)</a>
<a class="sourceLine" id="cb10-18" title="18"></a>
<a class="sourceLine" id="cb10-19" title="19">  <span class="co"># Evaluate function f(a_0) and f(b_0)</span></a>
<a class="sourceLine" id="cb10-20" title="20">  <span class="co"># 1. generate p</span></a>
<a class="sourceLine" id="cb10-21" title="21">  <span class="co"># 2. generate f_p</span></a>
<a class="sourceLine" id="cb10-22" title="22">  <span class="co"># 3. generate f_p*f_a</span></a>
<a class="sourceLine" id="cb10-23" title="23">  tb_states_choices_bisec &lt;-<span class="st"> </span>tb_states_choices_bisec <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-24" title="24"><span class="st">                              </span><span class="kw">mutate</span>(<span class="dt">p =</span> ((<span class="op">!!</span><span class="kw">sym</span>(svr_a_lst) <span class="op">+</span><span class="st"> </span><span class="op">!!</span><span class="kw">sym</span>(svr_b_lst))<span class="op">/</span><span class="dv">2</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-25" title="25"><span class="st">                              </span><span class="kw">mutate</span>(<span class="dt">f_p =</span> <span class="kw">ffi_nonlin_dplyrdo</span>(fl_A, fl_alpha, p,</a>
<a class="sourceLine" id="cb10-26" title="26">                                                              ar_nN_A, ar_nN_alpha,</a>
<a class="sourceLine" id="cb10-27" title="27">                                                              fl_N_agg, fl_rho)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-28" title="28"><span class="st">                              </span><span class="kw">mutate</span>(<span class="dt">f_p_t_f_a =</span> f_p<span class="op">*!!</span><span class="kw">sym</span>(svr_fa_lst))</a>
<a class="sourceLine" id="cb10-29" title="29">  <span class="co"># fl_p_dist2zr = sum(abs(p))</span></a>
<a class="sourceLine" id="cb10-30" title="30">  fl_p_dist2zr &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(tb_states_choices_bisec <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(f_p)))</a>
<a class="sourceLine" id="cb10-31" title="31"></a>
<a class="sourceLine" id="cb10-32" title="32">  <span class="co"># Update a and b</span></a>
<a class="sourceLine" id="cb10-33" title="33">  tb_states_choices_bisec &lt;-<span class="st"> </span>tb_states_choices_bisec <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-34" title="34"><span class="st">                              </span><span class="kw">mutate</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_a_cur) <span class="op">:</span><span class="er">=</span></a>
<a class="sourceLine" id="cb10-35" title="35"><span class="st">                                       </span><span class="kw">case_when</span>(f_p_t_f_a <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span><span class="op">!!</span><span class="kw">sym</span>(svr_a_lst),</a>
<a class="sourceLine" id="cb10-36" title="36">                                                 <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>p)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-37" title="37"><span class="st">                              </span><span class="kw">mutate</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_b_cur) <span class="op">:</span><span class="er">=</span></a>
<a class="sourceLine" id="cb10-38" title="38"><span class="st">                                       </span><span class="kw">case_when</span>(f_p_t_f_a <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span>p,</a>
<a class="sourceLine" id="cb10-39" title="39">                                                 <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="op">!!</span><span class="kw">sym</span>(svr_b_lst)))</a>
<a class="sourceLine" id="cb10-40" title="40">  <span class="co"># Update f(a) and f(b)</span></a>
<a class="sourceLine" id="cb10-41" title="41">  tb_states_choices_bisec &lt;-<span class="st"> </span>tb_states_choices_bisec <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-42" title="42"><span class="st">                              </span><span class="kw">mutate</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_fa_cur) <span class="op">:</span><span class="er">=</span></a>
<a class="sourceLine" id="cb10-43" title="43"><span class="st">                                       </span><span class="kw">case_when</span>(f_p_t_f_a <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span><span class="op">!!</span><span class="kw">sym</span>(svr_fa_lst),</a>
<a class="sourceLine" id="cb10-44" title="44">                                                 <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>f_p)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-45" title="45"><span class="st">                              </span><span class="kw">mutate</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_fb_cur) <span class="op">:</span><span class="er">=</span></a>
<a class="sourceLine" id="cb10-46" title="46"><span class="st">                                       </span><span class="kw">case_when</span>(f_p_t_f_a <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span>f_p,</a>
<a class="sourceLine" id="cb10-47" title="47">                                                 <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="op">!!</span><span class="kw">sym</span>(svr_fb_lst)))</a>
<a class="sourceLine" id="cb10-48" title="48">  <span class="co"># Save from last</span></a>
<a class="sourceLine" id="cb10-49" title="49">  svr_a_lst &lt;-<span class="st"> </span>svr_a_cur</a>
<a class="sourceLine" id="cb10-50" title="50">  svr_b_lst &lt;-<span class="st"> </span>svr_b_cur</a>
<a class="sourceLine" id="cb10-51" title="51">  svr_fa_lst &lt;-<span class="st"> </span>svr_fa_cur</a>
<a class="sourceLine" id="cb10-52" title="52">  svr_fb_lst &lt;-<span class="st"> </span>svr_fb_cur</a>
<a class="sourceLine" id="cb10-53" title="53"></a>
<a class="sourceLine" id="cb10-54" title="54">  <span class="co"># Summar current round</span></a>
<a class="sourceLine" id="cb10-55" title="55">  <span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'it_cur:'</span>, it_cur, <span class="st">', fl_p_dist2zr:'</span>, fl_p_dist2zr))</a>
<a class="sourceLine" id="cb10-56" title="56">  <span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(tb_states_choices_bisec <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">one_of</span>(svr_a_cur, svr_b_cur, svr_fa_cur, svr_fb_cur)))</a>
<a class="sourceLine" id="cb10-57" title="57">}</a></code></pre></div>
<pre><code>## [1] "it_cur:1, fl_p_dist2zr:2110.89580734824"
## [1] "it_cur:2, fl_p_dist2zr:916.745756204857"
## [1] "it_cur:3, fl_p_dist2zr:387.351245210125"
## [1] "it_cur:4, fl_p_dist2zr:155.209641366984"
## [1] "it_cur:5, fl_p_dist2zr:58.1570911334532"
## [1] "it_cur:6, fl_p_dist2zr:22.2118416173139"
## [1] "it_cur:7, fl_p_dist2zr:8.74989971240847"
## [1] "it_cur:8, fl_p_dist2zr:7.15872428611325"
## [1] "it_cur:9, fl_p_dist2zr:3.58472422897695"
## [1] "it_cur:10, fl_p_dist2zr:1.50543493747611"
## [1] "it_cur:11, fl_p_dist2zr:0.527052368572328"
## [1] "it_cur:12, fl_p_dist2zr:0.360171292121815"
## [1] "it_cur:13, fl_p_dist2zr:0.0545239655746409"
## [1] "it_cur:14, fl_p_dist2zr:0.152964071033218"
## [1] "it_cur:15, fl_p_dist2zr:0.0593547942434943"
## [1] "it_cur:16, fl_p_dist2zr:0.030716694397913"
## [1] "it_cur:17, fl_p_dist2zr:0.0177772298500779"
## [1] "it_cur:18, fl_p_dist2zr:0.00644396015251105"</code></pre>
</div>
<div id="reshape-wide-to-long-to-wide" class="section level2">
<h2 class="hasAnchor">
<a href="#reshape-wide-to-long-to-wide" class="anchor"></a>Reshape Wide to long to Wide</h2>
<p>To view results easily, how iterations improved to help us find the roots, convert table from wide to long. Pivot twice. This allows us to easily graph out how bisection is working out iterationby iteration.</p>
<p>Here, we will first show what the raw table looks like, the wide only table, and then show the long version, and finally the version that is medium wide.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="co"># New variables</span></a>
<a class="sourceLine" id="cb12-2" title="2">svr_bisect_iter &lt;-<span class="st"> 'biseciter'</span></a>
<a class="sourceLine" id="cb12-3" title="3">svr_abfafb_long_name &lt;-<span class="st"> 'varname'</span></a>
<a class="sourceLine" id="cb12-4" title="4">svr_number_col &lt;-<span class="st"> 'value'</span></a>
<a class="sourceLine" id="cb12-5" title="5">svr_id_bisect_iter &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(svr_id_var, <span class="st">'_bisect_ier'</span>)</a>
<a class="sourceLine" id="cb12-6" title="6"></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="co"># Pivot wide to very long</span></a>
<a class="sourceLine" id="cb12-8" title="8">tb_states_choices_bisec_long &lt;-<span class="st"> </span>tb_states_choices_bisec <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="st">  </span><span class="kw">pivot_longer</span>(</a>
<a class="sourceLine" id="cb12-10" title="10">    <span class="dt">cols =</span> <span class="kw">starts_with</span>(st_bisec_prefix),</a>
<a class="sourceLine" id="cb12-11" title="11">    <span class="dt">names_to =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(svr_abfafb_long_name, svr_bisect_iter),</a>
<a class="sourceLine" id="cb12-12" title="12">    <span class="dt">names_pattern =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(st_bisec_prefix, <span class="st">"(.*)_(.*)"</span>),</a>
<a class="sourceLine" id="cb12-13" title="13">    <span class="dt">values_to =</span> svr_number_col</a>
<a class="sourceLine" id="cb12-14" title="14">  )</a>
<a class="sourceLine" id="cb12-15" title="15"></a>
<a class="sourceLine" id="cb12-16" title="16"><span class="co"># Print</span></a>
<a class="sourceLine" id="cb12-17" title="17"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(tb_states_choices_bisec_long)</a></code></pre></div>
<pre><code>##     INDI_ID       fl_A       fl_alpha         p                f_p            
##  Min.   :1   Min.   :-2   Min.   :0.1   Min.   : 0.8427   Min.   :-1.874e-02  
##  1st Qu.:3   1st Qu.:-1   1st Qu.:0.3   1st Qu.: 3.3298   1st Qu.:-2.887e-03  
##  Median :5   Median : 0   Median :0.5   Median : 7.7381   Median : 1.987e-05  
##  Mean   :5   Mean   : 0   Mean   :0.5   Mean   :11.1111   Mean   :-2.921e-04  
##  3rd Qu.:7   3rd Qu.: 1   3rd Qu.:0.7   3rd Qu.:15.8810   3rd Qu.: 2.626e-03  
##  Max.   :9   Max.   : 2   Max.   :0.9   Max.   :31.5121   Max.   : 2.000e-02  
##    f_p_t_f_a            varname           biseciter        
##  Min.   :-6.210e-04   Length:684         Length:684        
##  1st Qu.:-6.641e-06   Class :character   Class :character  
##  Median : 2.350e-08   Mode  :character   Mode  :character  
##  Mean   : 2.613e-05                                        
##  3rd Qu.: 2.393e-05                                        
##  Max.   : 8.464e-04                                        
##      value           
##  Min.   :-24328.416  
##  1st Qu.:     0.000  
##  Median :     1.917  
##  Mean   :   -97.563  
##  3rd Qu.:    15.674  
##  Max.   :   100.000</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(tb_states_choices_bisec_long <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">one_of</span>(<span class="st">'p'</span>,<span class="st">'f_p'</span>,<span class="st">'f_p_t_f_a'</span>)), <span class="dv">30</span>)</a></code></pre></div>
<pre><code>## # A tibble: 30 x 6
##    INDI_ID  fl_A fl_alpha varname biseciter   value
##      &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt;
##  1       1    -2      0.1 a       0              0 
##  2       1    -2      0.1 b       0            100 
##  3       1    -2      0.1 fa      0            100 
##  4       1    -2      0.1 fb      0         -24328.
##  5       1    -2      0.1 a       1              0 
##  6       1    -2      0.1 b       1             50 
##  7       1    -2      0.1 fa      1            100 
##  8       1    -2      0.1 fb      1         -10867.
##  9       1    -2      0.1 a       2              0 
## 10       1    -2      0.1 b       2             25 
## # … with 20 more rows</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">tail</a></span>(tb_states_choices_bisec_long <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">one_of</span>(<span class="st">'p'</span>,<span class="st">'f_p'</span>,<span class="st">'f_p_t_f_a'</span>)), <span class="dv">30</span>)</a></code></pre></div>
<pre><code>## # A tibble: 30 x 6
##    INDI_ID  fl_A fl_alpha varname biseciter   value
##      &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt;
##  1       9     2      0.9 fa      11         0.0546
##  2       9     2      0.9 fb      11        -0.0940
##  3       9     2      0.9 a       12        31.5   
##  4       9     2      0.9 b       12        31.5   
##  5       9     2      0.9 fa      12         0.0546
##  6       9     2      0.9 fb      12        -0.0197
##  7       9     2      0.9 a       13        31.5   
##  8       9     2      0.9 b       13        31.5   
##  9       9     2      0.9 fa      13         0.0174
## 10       9     2      0.9 fb      13        -0.0197
## # … with 20 more rows</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1"><span class="co"># Pivot wide to very long to a little wide</span></a>
<a class="sourceLine" id="cb18-2" title="2">tb_states_choices_bisec_wider &lt;-<span class="st"> </span>tb_states_choices_bisec_long <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-3" title="3"><span class="st">  </span><span class="kw">pivot_wider</span>(</a>
<a class="sourceLine" id="cb18-4" title="4">    <span class="dt">names_from =</span> <span class="op">!!</span><span class="kw">sym</span>(svr_abfafb_long_name),</a>
<a class="sourceLine" id="cb18-5" title="5">    <span class="dt">values_from =</span> svr_number_col</a>
<a class="sourceLine" id="cb18-6" title="6">  )</a>
<a class="sourceLine" id="cb18-7" title="7"></a>
<a class="sourceLine" id="cb18-8" title="8"><span class="co"># Print</span></a>
<a class="sourceLine" id="cb18-9" title="9"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(tb_states_choices_bisec_wider)</a></code></pre></div>
<pre><code>##     INDI_ID       fl_A       fl_alpha         p                f_p            
##  Min.   :1   Min.   :-2   Min.   :0.1   Min.   : 0.8427   Min.   :-1.874e-02  
##  1st Qu.:3   1st Qu.:-1   1st Qu.:0.3   1st Qu.: 3.3298   1st Qu.:-2.887e-03  
##  Median :5   Median : 0   Median :0.5   Median : 7.7381   Median : 1.987e-05  
##  Mean   :5   Mean   : 0   Mean   :0.5   Mean   :11.1111   Mean   :-2.921e-04  
##  3rd Qu.:7   3rd Qu.: 1   3rd Qu.:0.7   3rd Qu.:15.8810   3rd Qu.: 2.626e-03  
##  Max.   :9   Max.   : 2   Max.   :0.9   Max.   :31.5121   Max.   : 2.000e-02  
##    f_p_t_f_a           biseciter               a                 b           
##  Min.   :-6.210e-04   Length:171         Min.   : 0.0000   Min.   :  0.8427  
##  1st Qu.:-6.641e-06   Class :character   1st Qu.: 0.8057   1st Qu.:  5.2093  
##  Median : 2.350e-08   Mode  :character   Median : 5.2002   Median : 11.7188  
##  Mean   : 2.613e-05                      Mean   : 8.9430   Mean   : 19.4693  
##  3rd Qu.: 2.393e-05                      3rd Qu.:15.6250   3rd Qu.: 25.0000  
##  Max.   : 8.464e-04                      Max.   :31.5121   Max.   :100.0000  
##        fa                  fb            
##  Min.   :  0.00002   Min.   :-24328.416  
##  1st Qu.:  0.04899   1st Qu.:   -45.805  
##  Median :  0.79745   Median :    -1.329  
##  Mean   : 25.85998   Mean   :  -444.523  
##  3rd Qu.: 21.38681   3rd Qu.:    -0.064  
##  Max.   :100.00000   Max.   :     0.000</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(tb_states_choices_bisec_wider <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">one_of</span>(<span class="st">'p'</span>,<span class="st">'f_p'</span>,<span class="st">'f_p_t_f_a'</span>)), <span class="dv">30</span>)</a></code></pre></div>
<pre><code>## # A tibble: 30 x 8
##    INDI_ID  fl_A fl_alpha biseciter     a       b     fa       fb
##      &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1       1    -2      0.1 0         0     100     100    -24328. 
##  2       1    -2      0.1 1         0      50     100    -10867. 
##  3       1    -2      0.1 2         0      25     100     -4828. 
##  4       1    -2      0.1 3         0      12.5   100     -2117. 
##  5       1    -2      0.1 4         0       6.25  100      -898. 
##  6       1    -2      0.1 5         0       3.12  100      -350. 
##  7       1    -2      0.1 6         0       1.56  100      -103. 
##  8       1    -2      0.1 7         0.781   1.56    8.29   -103. 
##  9       1    -2      0.1 8         0.781   1.17    8.29    -46.0
## 10       1    -2      0.1 9         0.781   0.977   8.29    -18.4
## # … with 20 more rows</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">tail</a></span>(tb_states_choices_bisec_wider <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">one_of</span>(<span class="st">'p'</span>,<span class="st">'f_p'</span>,<span class="st">'f_p_t_f_a'</span>)), <span class="dv">30</span>)</a></code></pre></div>
<pre><code>## # A tibble: 30 x 8
##    INDI_ID  fl_A fl_alpha biseciter     a     b      fa         fb
##      &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;
##  1       8   1.5      0.8 8          22.3  22.7 0.579   -1.13     
##  2       8   1.5      0.8 9          22.3  22.5 0.579   -0.278    
##  3       8   1.5      0.8 10         22.4  22.5 0.150   -0.278    
##  4       8   1.5      0.8 11         22.4  22.4 0.150   -0.0636   
##  5       8   1.5      0.8 12         22.4  22.4 0.0434  -0.0636   
##  6       8   1.5      0.8 13         22.4  22.4 0.0434  -0.0101   
##  7       8   1.5      0.8 14         22.4  22.4 0.0167  -0.0101   
##  8       8   1.5      0.8 15         22.4  22.4 0.00327 -0.0101   
##  9       8   1.5      0.8 16         22.4  22.4 0.00327 -0.00342  
## 10       8   1.5      0.8 17         22.4  22.4 0.00327 -0.0000761
## # … with 20 more rows</code></pre>
</div>
<div id="graph-bisection-iteration-results" class="section level2">
<h2 class="hasAnchor">
<a href="#graph-bisection-iteration-results" class="anchor"></a>Graph Bisection Iteration Results</h2>
<p>Actually we want to graph based on the long results, not the wider. Wider easier to view in table.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1"><span class="co"># Graph results</span></a>
<a class="sourceLine" id="cb24-2" title="2">lineplot &lt;-<span class="st"> </span>tb_states_choices_bisec_long <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb24-3" title="3"><span class="st">    </span><span class="kw">mutate</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_bisect_iter) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="op">!!</span><span class="kw">sym</span>(svr_bisect_iter))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb24-4" title="4"><span class="st">    </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="op">!!</span><span class="kw">sym</span>(svr_abfafb_long_name) <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'a'</span>, <span class="st">'b'</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb24-5" title="5"><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="op">!!</span><span class="kw">sym</span>(svr_bisect_iter), <span class="dt">y=</span><span class="op">!!</span><span class="kw">sym</span>(svr_number_col),</a>
<a class="sourceLine" id="cb24-6" title="6">               <span class="dt">colour=</span><span class="op">!!</span><span class="kw">sym</span>(svr_abfafb_long_name),</a>
<a class="sourceLine" id="cb24-7" title="7">               <span class="dt">linetype=</span><span class="op">!!</span><span class="kw">sym</span>(svr_abfafb_long_name),</a>
<a class="sourceLine" id="cb24-8" title="8">               <span class="dt">shape=</span><span class="op">!!</span><span class="kw">sym</span>(svr_abfafb_long_name))) <span class="op">+</span></a>
<a class="sourceLine" id="cb24-9" title="9"><span class="st">        </span><span class="kw">facet_wrap</span>( <span class="op">~</span><span class="st"> </span>INDI_ID) <span class="op">+</span></a>
<a class="sourceLine" id="cb24-10" title="10"><span class="st">        </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb24-11" title="11"><span class="st">        </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st">    </span></a>
<a class="sourceLine" id="cb24-12" title="12"><span class="st">        </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">'Bisection Iteration over individuals Until Convergence'</span>,</a>
<a class="sourceLine" id="cb24-13" title="13">             <span class="dt">x =</span> <span class="st">'Bisection Iteration'</span>,</a>
<a class="sourceLine" id="cb24-14" title="14">             <span class="dt">y =</span> <span class="st">'a (left side point) and b (right side point) values'</span>,</a>
<a class="sourceLine" id="cb24-15" title="15">             <span class="dt">caption =</span> <span class="st">'DPLYR concurrent bisection nonlinear multple individuals'</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb24-16" title="16"><span class="st">      </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb24-17" title="17"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(lineplot)</a></code></pre></div>
<p><img src="fv_opti_bisect_pmap_multi_files/figure-html/reshape%20solution%20for%20graphing-1.png" width="700"></p>
</div>
</div>
<div id="implement-bisection-as-a-function-over-dataframe" class="section level1">
<h1 class="hasAnchor">
<a href="#implement-bisection-as-a-function-over-dataframe" class="anchor"></a>Implement Bisection as A Function over Dataframe</h1>
<div id="define-bisection-algorithm-function" class="section level2">
<h2 class="hasAnchor">
<a href="#define-bisection-algorithm-function" class="anchor"></a>Define Bisection Algorithm Function</h2>
<p>Note the <em>df</em> input must have the not hard-coded input variables in <em>fc_withroot</em>, identical names. In particular, <em>svr_bisect_solu</em> should specify the name of the root variable: the x variable, which we are changing to solve for zero, whatever it is called in the <em>df</em> dataframe.</p>
<p>Inputs:</p>
<ul>
<li>
<em>ls_svr_df_in_func</em>: string list of variables in df that are inputs for fc_withroot.</li>
<li>
<em>svr_root_x</em>: the x variable name that appears n fc_withroot.</li>
</ul>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1">fv_opti_bisect_pmap_multi_test &lt;-<span class="st"> </span><span class="cf">function</span>(df, fc_withroot,</a>
<a class="sourceLine" id="cb25-2" title="2">                                           fl_lower_x, fl_upper_x,</a>
<a class="sourceLine" id="cb25-3" title="3">                                           ls_svr_df_in_func,</a>
<a class="sourceLine" id="cb25-4" title="4">                                           <span class="dt">svr_root_x =</span> <span class="st">'x'</span>,</a>
<a class="sourceLine" id="cb25-5" title="5">                                           <span class="dt">it_iter_tol =</span> <span class="dv">50</span>, <span class="dt">fl_zero_tol =</span> <span class="dv">10</span><span class="op">^-</span><span class="dv">5</span>,</a>
<a class="sourceLine" id="cb25-6" title="6">                                           <span class="dt">bl_keep_iter =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb25-7" title="7">                                           <span class="dt">st_bisec_prefix =</span> <span class="st">'bisec_'</span>,</a>
<a class="sourceLine" id="cb25-8" title="8">                                           <span class="dt">st_lower_x =</span> <span class="st">'a'</span>, <span class="dt">st_lower_fx =</span> <span class="st">'fa'</span>,</a>
<a class="sourceLine" id="cb25-9" title="9">                                           <span class="dt">st_upper_x =</span> <span class="st">'b'</span>, <span class="dt">st_upper_fx =</span> <span class="st">'fb'</span>) {</a>
<a class="sourceLine" id="cb25-10" title="10"></a>
<a class="sourceLine" id="cb25-11" title="11">  </a>
<a class="sourceLine" id="cb25-12" title="12"><span class="co"># A. common prefix to make reshaping easier</span></a>
<a class="sourceLine" id="cb25-13" title="13">svr_a_lst &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(st_bisec_prefix, st_lower_x, <span class="st">'_0'</span>)</a>
<a class="sourceLine" id="cb25-14" title="14">svr_b_lst &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(st_bisec_prefix, st_upper_x, <span class="st">'_0'</span>)</a>
<a class="sourceLine" id="cb25-15" title="15">svr_fa_lst &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(st_bisec_prefix, st_lower_fx, <span class="st">'_0'</span>)</a>
<a class="sourceLine" id="cb25-16" title="16">svr_fb_lst &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(st_bisec_prefix, st_upper_fx, <span class="st">'_0'</span>)</a>
<a class="sourceLine" id="cb25-17" title="17">svr_fxvr_name &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'f'</span>, svr_root_x)</a>
<a class="sourceLine" id="cb25-18" title="18">ls_pmap_vars &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(ls_svr_df_in_func, svr_root_x))</a>
<a class="sourceLine" id="cb25-19" title="19"></a>
<a class="sourceLine" id="cb25-20" title="20"><span class="co"># B. Add initial a and b</span></a>
<a class="sourceLine" id="cb25-21" title="21">df_bisec &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_a_lst) <span class="op">:</span><span class="er">=</span><span class="st"> </span>fl_lower_x, <span class="op">!!</span><span class="kw">sym</span>(svr_b_lst) <span class="op">:</span><span class="er">=</span><span class="st"> </span>fl_upper_x)</a>
<a class="sourceLine" id="cb25-22" title="22"></a>
<a class="sourceLine" id="cb25-23" title="23"><span class="co"># C. Evaluate function f(a_0) and f(b_0)</span></a>
<a class="sourceLine" id="cb25-24" title="24"><span class="co"># 1. set x = a_0</span></a>
<a class="sourceLine" id="cb25-25" title="25"><span class="co"># 2. evaluate f(a_0)</span></a>
<a class="sourceLine" id="cb25-26" title="26"><span class="co"># 3. set x = b_0</span></a>
<a class="sourceLine" id="cb25-27" title="27"><span class="co"># 4. evaluate f(b_0)</span></a>
<a class="sourceLine" id="cb25-28" title="28">df_bisec &lt;-<span class="st"> </span>df_bisec <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_root_x) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="op">!!</span><span class="kw">sym</span>(svr_a_lst))</a>
<a class="sourceLine" id="cb25-29" title="29">df_bisec &lt;-<span class="st"> </span>df_bisec <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb25-30" title="30">                <span class="op">!!</span><span class="kw">sym</span>(svr_fa_lst) <span class="op">:</span><span class="er">=</span></a>
<a class="sourceLine" id="cb25-31" title="31"><span class="st">                  </span><span class="kw"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(</a>
<a class="sourceLine" id="cb25-32" title="32">                    <span class="kw">pmap</span>(df_bisec <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(ls_pmap_vars), fc_withroot)</a>
<a class="sourceLine" id="cb25-33" title="33">                    )</a>
<a class="sourceLine" id="cb25-34" title="34">                )</a>
<a class="sourceLine" id="cb25-35" title="35">df_bisec &lt;-<span class="st"> </span>df_bisec <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_root_x) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="op">!!</span><span class="kw">sym</span>(svr_b_lst))</a>
<a class="sourceLine" id="cb25-36" title="36">df_bisec &lt;-<span class="st"> </span>df_bisec <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb25-37" title="37">                <span class="op">!!</span><span class="kw">sym</span>(svr_fb_lst) <span class="op">:</span><span class="er">=</span></a>
<a class="sourceLine" id="cb25-38" title="38"><span class="st">                  </span><span class="kw"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(</a>
<a class="sourceLine" id="cb25-39" title="39">                    <span class="kw">pmap</span>(df_bisec <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(ls_pmap_vars), fc_withroot)</a>
<a class="sourceLine" id="cb25-40" title="40">                    )</a>
<a class="sourceLine" id="cb25-41" title="41">                )</a>
<a class="sourceLine" id="cb25-42" title="42"></a>
<a class="sourceLine" id="cb25-43" title="43"><span class="co"># D. Iteration Convergence Criteria</span></a>
<a class="sourceLine" id="cb25-44" title="44"><span class="co"># fl_p_dist2zr = distance to zero to initalize</span></a>
<a class="sourceLine" id="cb25-45" title="45">fl_p_dist2zr &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb25-46" title="46">it_cur &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb25-47" title="47"><span class="cf">while</span> (it_cur <span class="op">&lt;=</span><span class="st"> </span>it_iter_tol <span class="op">&amp;&amp;</span><span class="st"> </span>fl_p_dist2zr <span class="op">&gt;=</span><span class="st"> </span>fl_zero_tol ) {</a>
<a class="sourceLine" id="cb25-48" title="48"></a>
<a class="sourceLine" id="cb25-49" title="49">  it_cur &lt;-<span class="st"> </span>it_cur <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb25-50" title="50"></a>
<a class="sourceLine" id="cb25-51" title="51">  <span class="co"># New Variables</span></a>
<a class="sourceLine" id="cb25-52" title="52">  svr_a_cur &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(st_bisec_prefix, st_lower_x, <span class="st">'_'</span>, it_cur)</a>
<a class="sourceLine" id="cb25-53" title="53">  svr_b_cur &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(st_bisec_prefix, st_upper_x, <span class="st">'_'</span>, it_cur)</a>
<a class="sourceLine" id="cb25-54" title="54">  svr_fa_cur &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(st_bisec_prefix, st_lower_fx, <span class="st">'_'</span>, it_cur)</a>
<a class="sourceLine" id="cb25-55" title="55">  svr_fb_cur &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(st_bisec_prefix, st_upper_fx, <span class="st">'_'</span>, it_cur)</a>
<a class="sourceLine" id="cb25-56" title="56"></a>
<a class="sourceLine" id="cb25-57" title="57">  <span class="co"># Evaluate function f(a_0) and f(b_0)</span></a>
<a class="sourceLine" id="cb25-58" title="58">  <span class="co"># 1. generate p</span></a>
<a class="sourceLine" id="cb25-59" title="59">  <span class="co"># 2. generate f_p</span></a>
<a class="sourceLine" id="cb25-60" title="60">  <span class="co"># 3. generate f_p*f_a</span></a>
<a class="sourceLine" id="cb25-61" title="61">  df_bisec &lt;-<span class="st"> </span>df_bisec <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_root_x) <span class="op">:</span><span class="er">=</span><span class="st"> </span>((<span class="op">!!</span><span class="kw">sym</span>(svr_a_lst) <span class="op">+</span><span class="st"> </span><span class="op">!!</span><span class="kw">sym</span>(svr_b_lst))<span class="op">/</span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb25-62" title="62">  df_bisec &lt;-<span class="st"> </span>df_bisec <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb25-63" title="63">                  <span class="op">!!</span><span class="kw">sym</span>(svr_fxvr_name) <span class="op">:</span><span class="er">=</span></a>
<a class="sourceLine" id="cb25-64" title="64"><span class="st">                    </span><span class="kw"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(</a>
<a class="sourceLine" id="cb25-65" title="65">                      <span class="kw">pmap</span>(df_bisec <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(ls_pmap_vars), fc_withroot)</a>
<a class="sourceLine" id="cb25-66" title="66">                      )</a>
<a class="sourceLine" id="cb25-67" title="67">                  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb25-68" title="68"><span class="st">                  </span><span class="kw">mutate</span>(<span class="dt">f_p_t_f_a =</span> <span class="op">!!</span><span class="kw">sym</span>(svr_fxvr_name)<span class="op">*!!</span><span class="kw">sym</span>(svr_fa_lst))</a>
<a class="sourceLine" id="cb25-69" title="69">  </a>
<a class="sourceLine" id="cb25-70" title="70">  <span class="co"># fl_p_dist2zr = sum(abs(p))</span></a>
<a class="sourceLine" id="cb25-71" title="71">  fl_p_dist2zr &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(df_bisec <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_fxvr_name))))</a>
<a class="sourceLine" id="cb25-72" title="72"></a>
<a class="sourceLine" id="cb25-73" title="73">  <span class="co"># Update a and b</span></a>
<a class="sourceLine" id="cb25-74" title="74">  df_bisec &lt;-<span class="st"> </span>df_bisec <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb25-75" title="75"><span class="st">                  </span><span class="kw">mutate</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_a_cur) <span class="op">:</span><span class="er">=</span></a>
<a class="sourceLine" id="cb25-76" title="76"><span class="st">                           </span><span class="kw">case_when</span>(f_p_t_f_a <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span><span class="op">!!</span><span class="kw">sym</span>(svr_a_lst),</a>
<a class="sourceLine" id="cb25-77" title="77">                                     <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="op">!!</span><span class="kw">sym</span>(svr_root_x))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb25-78" title="78"><span class="st">                  </span><span class="kw">mutate</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_b_cur) <span class="op">:</span><span class="er">=</span></a>
<a class="sourceLine" id="cb25-79" title="79"><span class="st">                           </span><span class="kw">case_when</span>(f_p_t_f_a <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span><span class="op">!!</span><span class="kw">sym</span>(svr_root_x),</a>
<a class="sourceLine" id="cb25-80" title="80">                                     <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="op">!!</span><span class="kw">sym</span>(svr_b_lst)))</a>
<a class="sourceLine" id="cb25-81" title="81">  </a>
<a class="sourceLine" id="cb25-82" title="82">  <span class="co"># Update f(a) and f(b)</span></a>
<a class="sourceLine" id="cb25-83" title="83">  df_bisec &lt;-<span class="st"> </span>df_bisec <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb25-84" title="84"><span class="st">                  </span><span class="kw">mutate</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_fa_cur) <span class="op">:</span><span class="er">=</span></a>
<a class="sourceLine" id="cb25-85" title="85"><span class="st">                           </span><span class="kw">case_when</span>(f_p_t_f_a <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span><span class="op">!!</span><span class="kw">sym</span>(svr_fa_lst),</a>
<a class="sourceLine" id="cb25-86" title="86">                                     <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="op">!!</span><span class="kw">sym</span>(svr_fxvr_name))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb25-87" title="87"><span class="st">                  </span><span class="kw">mutate</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_fb_cur) <span class="op">:</span><span class="er">=</span></a>
<a class="sourceLine" id="cb25-88" title="88"><span class="st">                           </span><span class="kw">case_when</span>(f_p_t_f_a <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span><span class="op">!!</span><span class="kw">sym</span>(svr_fxvr_name),</a>
<a class="sourceLine" id="cb25-89" title="89">                                     <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="op">!!</span><span class="kw">sym</span>(svr_fb_lst)))</a>
<a class="sourceLine" id="cb25-90" title="90">  </a>
<a class="sourceLine" id="cb25-91" title="91">  <span class="co"># Drop past record possibly</span></a>
<a class="sourceLine" id="cb25-92" title="92">  <span class="cf">if</span>(<span class="op">!</span>bl_keep_iter) {</a>
<a class="sourceLine" id="cb25-93" title="93">    df_bisec &lt;-<span class="st"> </span>df_bisec <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">one_of</span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(svr_a_lst, svr_b_lst, svr_fa_lst, svr_fb_lst)))</a>
<a class="sourceLine" id="cb25-94" title="94">  }</a>
<a class="sourceLine" id="cb25-95" title="95">  </a>
<a class="sourceLine" id="cb25-96" title="96">  <span class="co"># Save from last</span></a>
<a class="sourceLine" id="cb25-97" title="97">  svr_a_lst &lt;-<span class="st"> </span>svr_a_cur</a>
<a class="sourceLine" id="cb25-98" title="98">  svr_b_lst &lt;-<span class="st"> </span>svr_b_cur</a>
<a class="sourceLine" id="cb25-99" title="99">  svr_fa_lst &lt;-<span class="st"> </span>svr_fa_cur</a>
<a class="sourceLine" id="cb25-100" title="100">  svr_fb_lst &lt;-<span class="st"> </span>svr_fb_cur</a>
<a class="sourceLine" id="cb25-101" title="101"></a>
<a class="sourceLine" id="cb25-102" title="102">  <span class="co"># Summar current round</span></a>
<a class="sourceLine" id="cb25-103" title="103">  <span class="kw"><a href="https://rdrr.io/r/base/message.html">message</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'it_cur:'</span>, it_cur, <span class="st">', fl_p_dist2zr:'</span>, fl_p_dist2zr))</a>
<a class="sourceLine" id="cb25-104" title="104">}</a>
<a class="sourceLine" id="cb25-105" title="105"></a>
<a class="sourceLine" id="cb25-106" title="106"></a>
<a class="sourceLine" id="cb25-107" title="107"><span class="co"># return</span></a>
<a class="sourceLine" id="cb25-108" title="108"><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(df_bisec)</a>
<a class="sourceLine" id="cb25-109" title="109"></a>
<a class="sourceLine" id="cb25-110" title="110">}</a></code></pre></div>
</div>
<div id="prepare-inputs-to-invoke-bisection-function" class="section level2">
<h2 class="hasAnchor">
<a href="#prepare-inputs-to-invoke-bisection-function" class="anchor"></a>Prepare Inputs to Invoke Bisection Function</h2>
<p>Here we use the same function as earlier, but modify number of parameters:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" title="1"><span class="co"># Define Inputs</span></a>
<a class="sourceLine" id="cb26-2" title="2">df &lt;-<span class="st"> </span>tb_states_choices</a>
<a class="sourceLine" id="cb26-3" title="3">fc_withroot &lt;-<span class="st"> </span><span class="cf">function</span>(fl_A, fl_alpha, x){</a>
<a class="sourceLine" id="cb26-4" title="4">  <span class="co"># Function has four inputs hardcoded in: ar_nN_A, ar_nN_alpha, fl_rho, fl_N_agg</span></a>
<a class="sourceLine" id="cb26-5" title="5">  <span class="co"># Also renamed fl_N to x, indicating this is the x we are shifting to look for zero. </span></a>
<a class="sourceLine" id="cb26-6" title="6">  ar_p1_s1 =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>((fl_A <span class="op">-</span><span class="st"> </span>ar_nN_A)<span class="op">*</span>fl_rho)</a>
<a class="sourceLine" id="cb26-7" title="7">  ar_p1_s2 =<span class="st"> </span>(fl_alpha<span class="op">/</span>ar_nN_alpha)</a>
<a class="sourceLine" id="cb26-8" title="8">  ar_p1_s3 =<span class="st"> </span>(<span class="dv">1</span><span class="op">/</span>(ar_nN_alpha<span class="op">*</span>fl_rho <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb26-9" title="9">  ar_p1 =<span class="st"> </span>(ar_p1_s1<span class="op">*</span>ar_p1_s2)<span class="op">^</span>ar_p1_s3</a>
<a class="sourceLine" id="cb26-10" title="10">  ar_p2 =<span class="st"> </span>x<span class="op">^</span>((fl_alpha<span class="op">*</span>fl_rho<span class="dv">-1</span>)<span class="op">/</span>(ar_nN_alpha<span class="op">*</span>fl_rho<span class="dv">-1</span>))</a>
<a class="sourceLine" id="cb26-11" title="11">  ar_overall =<span class="st"> </span>ar_p1<span class="op">*</span>ar_p2</a>
<a class="sourceLine" id="cb26-12" title="12">  fl_overall =<span class="st"> </span>fl_N_agg <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(ar_overall)</a>
<a class="sourceLine" id="cb26-13" title="13">  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(fl_overall)</a>
<a class="sourceLine" id="cb26-14" title="14">}</a>
<a class="sourceLine" id="cb26-15" title="15">fl_lower_x &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb26-16" title="16">fl_upper_x &lt;-<span class="st"> </span><span class="dv">200</span></a>
<a class="sourceLine" id="cb26-17" title="17">ls_svr_df_in_func &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'fl_A'</span>, <span class="st">'fl_alpha'</span>)</a>
<a class="sourceLine" id="cb26-18" title="18">svr_root_x &lt;-<span class="st"> 'x'</span></a>
<a class="sourceLine" id="cb26-19" title="19">fl_zero_tol =<span class="st"> </span><span class="dv">10</span><span class="op">^-</span><span class="dv">6</span></a></code></pre></div>
<p>Additionally, let’s prepare a very simple linear test:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1">ar_intercept =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">-1</span>, <span class="dt">length.out =</span> it_N_child_cnt)</a>
<a class="sourceLine" id="cb27-2" title="2">ar_slope =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dt">length.out =</span> it_N_child_cnt)</a>
<a class="sourceLine" id="cb27-3" title="3">df_lines &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(ar_intercept, ar_slope)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rowid_to_column</span>(<span class="dt">var=</span><span class="st">'ID'</span>)</a>
<a class="sourceLine" id="cb27-4" title="4">ar_st_col_names =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'ID'</span>,<span class="st">'fl_int'</span>, <span class="st">'fl_slope'</span>)</a>
<a class="sourceLine" id="cb27-5" title="5">df_lines &lt;-<span class="st"> </span>df_lines <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename_all</span>(<span class="op">~</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(ar_st_col_names))</a>
<a class="sourceLine" id="cb27-6" title="6">fc_withroot_line &lt;-<span class="st"> </span><span class="cf">function</span>(fl_int, fl_slope, x){</a>
<a class="sourceLine" id="cb27-7" title="7">  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(fl_int <span class="op">+</span><span class="st"> </span>fl_slope<span class="op">*</span>x)</a>
<a class="sourceLine" id="cb27-8" title="8">}</a>
<a class="sourceLine" id="cb27-9" title="9">fl_lower_x_line &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb27-10" title="10">fl_upper_x_line &lt;-<span class="st"> </span><span class="dv">100000</span></a>
<a class="sourceLine" id="cb27-11" title="11">ls_svr_df_in_func_line &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'fl_int'</span>, <span class="st">'fl_slope'</span>)</a>
<a class="sourceLine" id="cb27-12" title="12">svr_root_x_line &lt;-<span class="st"> 'x'</span></a>
<a class="sourceLine" id="cb27-13" title="13">fl_zero_tol =<span class="st"> </span><span class="dv">10</span><span class="op">^-</span><span class="dv">6</span></a></code></pre></div>
</div>
<div id="test-function" class="section level2">
<h2 class="hasAnchor">
<a href="#test-function" class="anchor"></a>Test Function</h2>
<p>Now we call the function to see if it works:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" title="1">df_bisec &lt;-<span class="st"> </span><span class="kw">fv_opti_bisect_pmap_multi_test</span>(df, fc_withroot, fl_lower_x,fl_upper_x,</a>
<a class="sourceLine" id="cb28-2" title="2">                                           ls_svr_df_in_func, svr_root_x, <span class="dt">bl_keep_iter =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## it_cur:1, fl_p_dist2zr:4736.99534218055</code></pre>
<pre><code>## it_cur:2, fl_p_dist2zr:2110.89580734824</code></pre>
<pre><code>## it_cur:3, fl_p_dist2zr:916.745756204857</code></pre>
<pre><code>## it_cur:4, fl_p_dist2zr:387.351245210125</code></pre>
<pre><code>## it_cur:5, fl_p_dist2zr:155.209641366984</code></pre>
<pre><code>## it_cur:6, fl_p_dist2zr:58.1570911334532</code></pre>
<pre><code>## it_cur:7, fl_p_dist2zr:22.2118416173139</code></pre>
<pre><code>## it_cur:8, fl_p_dist2zr:8.74989971240847</code></pre>
<pre><code>## it_cur:9, fl_p_dist2zr:7.15872428611325</code></pre>
<pre><code>## it_cur:10, fl_p_dist2zr:3.58472422897695</code></pre>
<pre><code>## it_cur:11, fl_p_dist2zr:1.50543493747611</code></pre>
<pre><code>## it_cur:12, fl_p_dist2zr:0.527052368572328</code></pre>
<pre><code>## it_cur:13, fl_p_dist2zr:0.360171292121815</code></pre>
<pre><code>## it_cur:14, fl_p_dist2zr:0.0545239655746409</code></pre>
<pre><code>## it_cur:15, fl_p_dist2zr:0.152964071033218</code></pre>
<pre><code>## it_cur:16, fl_p_dist2zr:0.0593547942434943</code></pre>
<pre><code>## it_cur:17, fl_p_dist2zr:0.030716694397913</code></pre>
<pre><code>## it_cur:18, fl_p_dist2zr:0.0177772298500779</code></pre>
<pre><code>## it_cur:19, fl_p_dist2zr:0.00644396015251105</code></pre>
<pre><code>## it_cur:20, fl_p_dist2zr:0.00242474898992384</code></pre>
<pre><code>## it_cur:21, fl_p_dist2zr:0.00163155064414077</code></pre>
<pre><code>## it_cur:22, fl_p_dist2zr:0.000398869003509124</code></pre>
<pre><code>## it_cur:23, fl_p_dist2zr:0.000450010969980023</code></pre>
<pre><code>## it_cur:24, fl_p_dist2zr:0.000192696055121486</code></pre>
<pre><code>## it_cur:25, fl_p_dist2zr:4.77090151996941e-05</code></pre>
<pre><code>## it_cur:26, fl_p_dist2zr:4.87038981494455e-05</code></pre>
<pre><code>## it_cur:27, fl_p_dist2zr:2.28095363736555e-05</code></pre>
<pre><code>## it_cur:28, fl_p_dist2zr:3.72447202165757e-06</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" title="1"><span class="co"># Do individual inputs sum up to total allocations available</span></a>
<a class="sourceLine" id="cb57-2" title="2">fl_allocated &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(df_bisec <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(svr_root_x))</a>
<a class="sourceLine" id="cb57-3" title="3"><span class="cf">if</span> (fl_N_agg <span class="op">==</span><span class="st"> </span>fl_allocated){</a>
<a class="sourceLine" id="cb57-4" title="4">  <span class="kw"><a href="https://rdrr.io/r/base/message.html">message</a></span>(<span class="st">'Total Input Available = Sum of Optimal Individual Allocations'</span>)</a>
<a class="sourceLine" id="cb57-5" title="5">} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb57-6" title="6">  <span class="kw"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">'fl_N_agg ='</span>, fl_N_agg, <span class="st">', but, sum(df_bisec %&gt;% pull(svr_root_x))='</span>, fl_allocated)</a>
<a class="sourceLine" id="cb57-7" title="7">}</a></code></pre></div>
<pre><code>## fl_N_agg = 100 , but, sum(df_bisec %&gt;% pull(svr_root_x))= 100</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" title="1"><span class="co"># Show all </span></a>
<a class="sourceLine" id="cb59-2" title="2">df_bisec</a></code></pre></div>
<pre><code>## # A tibble: 9 x 122
##   INDI_ID  fl_A fl_alpha bisec_a_0 bisec_b_0      x bisec_fa_0 bisec_fb_0
##     &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
## 1       1  -2        0.1         0       200  0.843        100    -54364.
## 2       2  -1.5      0.2         0       200  1.92         100    -18749.
## 3       3  -1        0.3         0       200  3.33         100     -9069.
## 4       4  -0.5      0.4         0       200  5.21         100     -5027.
## 5       5   0        0.5         0       200  7.74         100     -2995.
## 6       6   0.5      0.6         0       200 11.2          100     -1861.
## 7       7   1        0.7         0       200 15.9          100     -1184.
## 8       8   1.5      0.8         0       200 22.4          100      -762.
## 9       9   2        0.9         0       200 31.5          100      -490.
## # … with 114 more variables: fx &lt;dbl&gt;, f_p_t_f_a &lt;dbl&gt;, bisec_a_1 &lt;dbl&gt;,
## #   bisec_b_1 &lt;dbl&gt;, bisec_fa_1 &lt;dbl&gt;, bisec_fb_1 &lt;dbl&gt;, bisec_a_2 &lt;dbl&gt;,
## #   bisec_b_2 &lt;dbl&gt;, bisec_fa_2 &lt;dbl&gt;, bisec_fb_2 &lt;dbl&gt;, bisec_a_3 &lt;dbl&gt;,
## #   bisec_b_3 &lt;dbl&gt;, bisec_fa_3 &lt;dbl&gt;, bisec_fb_3 &lt;dbl&gt;, bisec_a_4 &lt;dbl&gt;,
## #   bisec_b_4 &lt;dbl&gt;, bisec_fa_4 &lt;dbl&gt;, bisec_fb_4 &lt;dbl&gt;, bisec_a_5 &lt;dbl&gt;,
## #   bisec_b_5 &lt;dbl&gt;, bisec_fa_5 &lt;dbl&gt;, bisec_fb_5 &lt;dbl&gt;, bisec_a_6 &lt;dbl&gt;,
## #   bisec_b_6 &lt;dbl&gt;, bisec_fa_6 &lt;dbl&gt;, bisec_fb_6 &lt;dbl&gt;, bisec_a_7 &lt;dbl&gt;,
## #   bisec_b_7 &lt;dbl&gt;, bisec_fa_7 &lt;dbl&gt;, bisec_fb_7 &lt;dbl&gt;, bisec_a_8 &lt;dbl&gt;,
## #   bisec_b_8 &lt;dbl&gt;, bisec_fa_8 &lt;dbl&gt;, bisec_fb_8 &lt;dbl&gt;, bisec_a_9 &lt;dbl&gt;,
## #   bisec_b_9 &lt;dbl&gt;, bisec_fa_9 &lt;dbl&gt;, bisec_fb_9 &lt;dbl&gt;, bisec_a_10 &lt;dbl&gt;,
## #   bisec_b_10 &lt;dbl&gt;, bisec_fa_10 &lt;dbl&gt;, bisec_fb_10 &lt;dbl&gt;, bisec_a_11 &lt;dbl&gt;,
## #   bisec_b_11 &lt;dbl&gt;, bisec_fa_11 &lt;dbl&gt;, bisec_fb_11 &lt;dbl&gt;, bisec_a_12 &lt;dbl&gt;,
## #   bisec_b_12 &lt;dbl&gt;, bisec_fa_12 &lt;dbl&gt;, bisec_fb_12 &lt;dbl&gt;, bisec_a_13 &lt;dbl&gt;,
## #   bisec_b_13 &lt;dbl&gt;, bisec_fa_13 &lt;dbl&gt;, bisec_fb_13 &lt;dbl&gt;, bisec_a_14 &lt;dbl&gt;,
## #   bisec_b_14 &lt;dbl&gt;, bisec_fa_14 &lt;dbl&gt;, bisec_fb_14 &lt;dbl&gt;, bisec_a_15 &lt;dbl&gt;,
## #   bisec_b_15 &lt;dbl&gt;, bisec_fa_15 &lt;dbl&gt;, bisec_fb_15 &lt;dbl&gt;, bisec_a_16 &lt;dbl&gt;,
## #   bisec_b_16 &lt;dbl&gt;, bisec_fa_16 &lt;dbl&gt;, bisec_fb_16 &lt;dbl&gt;, bisec_a_17 &lt;dbl&gt;,
## #   bisec_b_17 &lt;dbl&gt;, bisec_fa_17 &lt;dbl&gt;, bisec_fb_17 &lt;dbl&gt;, bisec_a_18 &lt;dbl&gt;,
## #   bisec_b_18 &lt;dbl&gt;, bisec_fa_18 &lt;dbl&gt;, bisec_fb_18 &lt;dbl&gt;, bisec_a_19 &lt;dbl&gt;,
## #   bisec_b_19 &lt;dbl&gt;, bisec_fa_19 &lt;dbl&gt;, bisec_fb_19 &lt;dbl&gt;, bisec_a_20 &lt;dbl&gt;,
## #   bisec_b_20 &lt;dbl&gt;, bisec_fa_20 &lt;dbl&gt;, bisec_fb_20 &lt;dbl&gt;, bisec_a_21 &lt;dbl&gt;,
## #   bisec_b_21 &lt;dbl&gt;, bisec_fa_21 &lt;dbl&gt;, bisec_fb_21 &lt;dbl&gt;, bisec_a_22 &lt;dbl&gt;,
## #   bisec_b_22 &lt;dbl&gt;, bisec_fa_22 &lt;dbl&gt;, bisec_fb_22 &lt;dbl&gt;, bisec_a_23 &lt;dbl&gt;,
## #   bisec_b_23 &lt;dbl&gt;, bisec_fa_23 &lt;dbl&gt;, bisec_fb_23 &lt;dbl&gt;, bisec_a_24 &lt;dbl&gt;,
## #   bisec_b_24 &lt;dbl&gt;, bisec_fa_24 &lt;dbl&gt;, bisec_fb_24 &lt;dbl&gt;, bisec_a_25 &lt;dbl&gt;,
## #   bisec_b_25 &lt;dbl&gt;, …</code></pre>
<p>Call the same function, but do not save history:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" title="1">df_bisec &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span>(<span class="kw">fv_opti_bisect_pmap_multi_test</span>(df, fc_withroot, fl_lower_x, fl_upper_x,</a>
<a class="sourceLine" id="cb61-2" title="2">                                                            ls_svr_df_in_func, svr_root_x, <span class="dt">bl_keep_iter =</span> <span class="ot">FALSE</span>))</a>
<a class="sourceLine" id="cb61-3" title="3">df_bisec <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">one_of</span>(<span class="st">'f_p_t_f_a'</span>))</a></code></pre></div>
<pre><code>## # A tibble: 9 x 9
##   INDI_ID  fl_A fl_alpha      x       fx bisec_a_28 bisec_b_28 bisec_fa_28
##     &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;
## 1       1  -2        0.1  0.843  1.35e-6      0.843      0.843 0.00000135 
## 2       2  -1.5      0.2  1.92  -1.23e-5      1.92       1.92  0.0000313  
## 3       3  -1        0.3  3.33  -9.41e-6      3.33       3.33  0.0000152  
## 4       4  -0.5      0.4  5.21  -4.38e-6      5.21       5.21  0.0000110  
## 5       5   0        0.5  7.74   5.55e-7      7.74       7.74  0.000000555
## 6       6   0.5      0.6 11.2    3.55e-6     11.2       11.2   0.00000355 
## 7       7   1        0.7 15.9   -5.55e-7     15.9       15.9   0.00000416 
## 8       8   1.5      0.8 22.4   -9.41e-7     22.4       22.4   0.00000233 
## 9       9   2        0.9 31.5   -5.27e-7     31.5       31.5   0.00000174 
## # … with 1 more variable: bisec_fb_28 &lt;dbl&gt;</code></pre>
<p>Call the linear root function:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" title="1">df_bisec &lt;-<span class="st"> </span><span class="kw">fv_opti_bisect_pmap_multi_test</span>(df_lines, fc_withroot_line,</a>
<a class="sourceLine" id="cb63-2" title="2">                                           fl_lower_x_line, fl_upper_x_line,</a>
<a class="sourceLine" id="cb63-3" title="3">                                           ls_svr_df_in_func_line, svr_root_x_line, <span class="dt">bl_keep_iter =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## it_cur:1, fl_p_dist2zr:27494.5</code></pre>
<pre><code>## it_cur:2, fl_p_dist2zr:13744.5</code></pre>
<pre><code>## it_cur:3, fl_p_dist2zr:6869.5</code></pre>
<pre><code>## it_cur:4, fl_p_dist2zr:3432</code></pre>
<pre><code>## it_cur:5, fl_p_dist2zr:1713.25</code></pre>
<pre><code>## it_cur:6, fl_p_dist2zr:853.875</code></pre>
<pre><code>## it_cur:7, fl_p_dist2zr:424.1875</code></pre>
<pre><code>## it_cur:8, fl_p_dist2zr:209.34375</code></pre>
<pre><code>## it_cur:9, fl_p_dist2zr:101.921875</code></pre>
<pre><code>## it_cur:10, fl_p_dist2zr:48.2630208333333</code></pre>
<pre><code>## it_cur:11, fl_p_dist2zr:22.4405381944444</code></pre>
<pre><code>## it_cur:12, fl_p_dist2zr:9.83213975694444</code></pre>
<pre><code>## it_cur:13, fl_p_dist2zr:4.24430338541667</code></pre>
<pre><code>## it_cur:14, fl_p_dist2zr:1.79055447048611</code></pre>
<pre><code>## it_cur:15, fl_p_dist2zr:0.783148871527778</code></pre>
<pre><code>## it_cur:16, fl_p_dist2zr:0.419854058159722</code></pre>
<pre><code>## it_cur:17, fl_p_dist2zr:0.137461344401042</code></pre>
<pre><code>## it_cur:18, fl_p_dist2zr:0.0981631808810763</code></pre>
<pre><code>## it_cur:19, fl_p_dist2zr:0.0471479627821184</code></pre>
<pre><code>## it_cur:20, fl_p_dist2zr:0.0238359239366318</code></pre>
<pre><code>## it_cur:21, fl_p_dist2zr:0.0155442555745441</code></pre>
<pre><code>## it_cur:22, fl_p_dist2zr:0.00779639350043383</code></pre>
<pre><code>## it_cur:23, fl_p_dist2zr:0.00397608015272343</code></pre>
<pre><code>## it_cur:24, fl_p_dist2zr:0.00209707683987107</code></pre>
<pre><code>## it_cur:25, fl_p_dist2zr:0.000747521718342902</code></pre>
<pre><code>## it_cur:26, fl_p_dist2zr:0.000320964389377071</code></pre>
<pre><code>## it_cur:27, fl_p_dist2zr:0.000268595086203484</code></pre>
<pre><code>## it_cur:28, fl_p_dist2zr:7.08483987382399e-05</code></pre>
<pre><code>## it_cur:29, fl_p_dist2zr:4.65694401001255e-05</code></pre>
<pre><code>## it_cur:30, fl_p_dist2zr:2.71068678960873e-05</code></pre>
<pre><code>## it_cur:31, fl_p_dist2zr:1.14395386645841e-05</code></pre>
<pre><code>## it_cur:32, fl_p_dist2zr:6.38038747870063e-06</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" title="1">df_bisec <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">one_of</span>(<span class="st">'f_p_t_f_a'</span>))</a></code></pre></div>
<pre><code>## # A tibble: 9 x 9
##      ID fl_int fl_slope      x       fx bisec_a_32 bisec_b_32 bisec_fa_32
##   &lt;int&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;
## 1     1 -10       0.1   100.   -6.89e-7     100.       100.      -6.89e-7
## 2     2  -8.88    0.213  41.8   2.68e-6      41.8       41.8     -2.27e-6
## 3     3  -7.75    0.325  23.8   3.72e-6      23.8       23.8     -3.85e-6
## 4     4  -6.62    0.438  15.1   2.42e-6      15.1       15.1     -7.76e-6
## 5     5  -5.5     0.55   10.0   3.46e-6      10.0       10.0     -9.34e-6
## 6     6  -4.38    0.662   6.60 -1.41e-5       6.60       6.60    -1.41e-5
## 7     7  -3.25    0.775   4.19 -9.60e-6       4.19       4.19    -9.60e-6
## 8     8  -2.12    0.888   2.39 -5.06e-6       2.39       2.39    -5.06e-6
## 9     9  -1       1       1.00 -1.57e-5       1.00       1.00    -1.57e-5
## # … with 1 more variable: bisec_fb_32 &lt;dbl&gt;</code></pre>
</div>
<div id="test-with-prjoptialloc-log-results" class="section level2">
<h2 class="hasAnchor">
<a href="#test-with-prjoptialloc-log-results" class="anchor"></a>Test with PrjOptiAlloc log results</h2>
<p>Use <em>df_esti</em> from <a href="https://fanwangecon.github.io/PrjOptiAlloc/reference/df_opt_dtgch_cbem4.html"><em>ffy_opt_dtgch_cbem4</em></a> function of project <em>PrjOptiAlloc</em>. Select only the <em>fl_A</em> and <em>fl_alpha</em> variables, should look like <em>tb_states_choices</em>. The difference is that <em>tb_states_choices</em> values were made up, but the <em>alpha</em> and <em>A</em> values from <em>df_esti</em> are estimated.</p>
<p>The function is the same as before: <em>fc_withroot</em>, in fact, this function is the solution to the log linear allocation from problem <a href="https://fanwangecon.github.io/PrjOptiAlloc/">PrjOptiAlloc</a>.</p>
<p>First define the data frame:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" title="1"><span class="co"># Load Package and Data</span></a>
<a class="sourceLine" id="cb98-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(PrjOptiAlloc)</a>
<a class="sourceLine" id="cb98-3" title="3">ls_opti_alpha_A &lt;-<span class="st"> </span><span class="kw">ffy_opt_dtgch_cbem4</span>()</a>
<a class="sourceLine" id="cb98-4" title="4">df_esti &lt;-<span class="st"> </span>ls_opti_alpha_A<span class="op">$</span>df_esti</a>
<a class="sourceLine" id="cb98-5" title="5"></a>
<a class="sourceLine" id="cb98-6" title="6"><span class="co"># Select only some individuals to speed up test</span></a>
<a class="sourceLine" id="cb98-7" title="7">df_esti &lt;-<span class="st"> </span>df_esti <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(indi.id <span class="op">&lt;=</span><span class="st"> </span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb98-8" title="8"></a>
<a class="sourceLine" id="cb98-9" title="9"><span class="co"># Select only A and Alpha and Index </span></a>
<a class="sourceLine" id="cb98-10" title="10"><span class="co"># %&gt;% mutate(A_log =(A_log))</span></a>
<a class="sourceLine" id="cb98-11" title="11">df_dtgch_cbem4_bisec &lt;-<span class="st"> </span>df_esti <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(indi.id, A_log, alpha_log) </a>
<a class="sourceLine" id="cb98-12" title="12">ar_st_col_names =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'INDI_ID'</span>, <span class="st">'fl_A'</span>, <span class="st">'fl_alpha'</span>)</a>
<a class="sourceLine" id="cb98-13" title="13">df &lt;-<span class="st"> </span>df_dtgch_cbem4_bisec <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename_all</span>(<span class="op">~</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(ar_st_col_names))</a></code></pre></div>
<p>Crucially, also need to redefine the function, note that the function formula we are using here is the same as before, however, there are Hard-Coded vectors in the formula, that need to reflect the new dataframe.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" title="1"><span class="co"># hard-coded parameters</span></a>
<a class="sourceLine" id="cb99-2" title="2">ar_nN_A &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(fl_A)</a>
<a class="sourceLine" id="cb99-3" title="3">ar_nN_alpha &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(fl_alpha)</a>
<a class="sourceLine" id="cb99-4" title="4"><span class="co"># Function again updating the hard-coded parameters</span></a>
<a class="sourceLine" id="cb99-5" title="5">fc_withroot &lt;-<span class="st"> </span><span class="cf">function</span>(fl_A, fl_alpha, x){</a>
<a class="sourceLine" id="cb99-6" title="6">  <span class="co"># Function has four inputs hardcoded in: ar_nN_A, ar_nN_alpha, fl_rho, fl_N_agg</span></a>
<a class="sourceLine" id="cb99-7" title="7">  <span class="co"># Also renamed fl_N to x, indicating this is the x we are shifting to look for zero. </span></a>
<a class="sourceLine" id="cb99-8" title="8">  ar_p1_s1 =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>((fl_A <span class="op">-</span><span class="st"> </span>ar_nN_A)<span class="op">*</span>fl_rho)</a>
<a class="sourceLine" id="cb99-9" title="9">  ar_p1_s2 =<span class="st"> </span>(fl_alpha<span class="op">/</span>ar_nN_alpha)</a>
<a class="sourceLine" id="cb99-10" title="10">  ar_p1_s3 =<span class="st"> </span>(<span class="dv">1</span><span class="op">/</span>(ar_nN_alpha<span class="op">*</span>fl_rho <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb99-11" title="11">  ar_p1 =<span class="st"> </span>(ar_p1_s1<span class="op">*</span>ar_p1_s2)<span class="op">^</span>ar_p1_s3</a>
<a class="sourceLine" id="cb99-12" title="12">  ar_p2 =<span class="st"> </span>x<span class="op">^</span>((fl_alpha<span class="op">*</span>fl_rho<span class="dv">-1</span>)<span class="op">/</span>(ar_nN_alpha<span class="op">*</span>fl_rho<span class="dv">-1</span>))</a>
<a class="sourceLine" id="cb99-13" title="13">  ar_overall =<span class="st"> </span>ar_p1<span class="op">*</span>ar_p2</a>
<a class="sourceLine" id="cb99-14" title="14">  fl_overall =<span class="st"> </span>fl_N_agg <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(ar_overall)</a>
<a class="sourceLine" id="cb99-15" title="15">  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(fl_overall)</a>
<a class="sourceLine" id="cb99-16" title="16">}</a></code></pre></div>
<p>Finally call and solve with the bisection function:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" title="1"><span class="co"># Bisect and Solve</span></a>
<a class="sourceLine" id="cb100-2" title="2">ls_svr_df_in_func &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'fl_A'</span>, <span class="st">'fl_alpha'</span>)</a>
<a class="sourceLine" id="cb100-3" title="3">svr_root_x &lt;-<span class="st"> 'x'</span></a>
<a class="sourceLine" id="cb100-4" title="4">df_bisec_dtgch_cbem4 &lt;-<span class="st"> </span><span class="kw">fv_opti_bisect_pmap_multi_test</span>(df, fc_withroot,</a>
<a class="sourceLine" id="cb100-5" title="5">                                                       <span class="dv">0</span>, fl_upper_x,</a>
<a class="sourceLine" id="cb100-6" title="6">                                                       ls_svr_df_in_func, svr_root_x,</a>
<a class="sourceLine" id="cb100-7" title="7">                                                       <span class="dt">bl_keep_iter =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## it_cur:1, fl_p_dist2zr:899.86958899644</code></pre>
<pre><code>## it_cur:2, fl_p_dist2zr:399.795325546567</code></pre>
<pre><code>## it_cur:3, fl_p_dist2zr:149.82803720318</code></pre>
<pre><code>## it_cur:4, fl_p_dist2zr:39.6981877915583</code></pre>
<pre><code>## it_cur:5, fl_p_dist2zr:22.7544373106979</code></pre>
<pre><code>## it_cur:6, fl_p_dist2zr:13.6648690730157</code></pre>
<pre><code>## it_cur:7, fl_p_dist2zr:4.00882580615786</code></pre>
<pre><code>## it_cur:8, fl_p_dist2zr:5.16853400177715</code></pre>
<pre><code>## it_cur:9, fl_p_dist2zr:1.51302257271096</code></pre>
<pre><code>## it_cur:10, fl_p_dist2zr:0.652943611605188</code></pre>
<pre><code>## it_cur:11, fl_p_dist2zr:0.600480528493414</code></pre>
<pre><code>## it_cur:12, fl_p_dist2zr:0.250509919781611</code></pre>
<pre><code>## it_cur:13, fl_p_dist2zr:0.0896781862774658</code></pre>
<pre><code>## it_cur:14, fl_p_dist2zr:0.0538247482166633</code></pre>
<pre><code>## it_cur:15, fl_p_dist2zr:0.0239801341471519</code></pre>
<pre><code>## it_cur:16, fl_p_dist2zr:0.0140266432007429</code></pre>
<pre><code>## it_cur:17, fl_p_dist2zr:0.00893928482057681</code></pre>
<pre><code>## it_cur:18, fl_p_dist2zr:0.00357052465549164</code></pre>
<pre><code>## it_cur:19, fl_p_dist2zr:0.00185480902755507</code></pre>
<pre><code>## it_cur:20, fl_p_dist2zr:0.0008568164157244</code></pre>
<pre><code>## it_cur:21, fl_p_dist2zr:0.000597378694812455</code></pre>
<pre><code>## it_cur:22, fl_p_dist2zr:0.000310870384761112</code></pre>
<pre><code>## it_cur:23, fl_p_dist2zr:0.000106146686901651</code></pre>
<pre><code>## it_cur:24, fl_p_dist2zr:7.78112187778864e-05</code></pre>
<pre><code>## it_cur:25, fl_p_dist2zr:2.60678871689556e-05</code></pre>
<pre><code>## it_cur:26, fl_p_dist2zr:1.31156909364765e-05</code></pre>
<pre><code>## it_cur:27, fl_p_dist2zr:9.57136451360283e-06</code></pre>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" title="1"><span class="co"># Do individual inputs sum up to total allocations available</span></a>
<a class="sourceLine" id="cb128-2" title="2">fl_allocated &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(df_bisec_dtgch_cbem4 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(svr_root_x))</a>
<a class="sourceLine" id="cb128-3" title="3"><span class="cf">if</span> (fl_N_agg <span class="op">==</span><span class="st"> </span>fl_allocated){</a>
<a class="sourceLine" id="cb128-4" title="4">  <span class="kw"><a href="https://rdrr.io/r/base/message.html">message</a></span>(<span class="st">'Total Input Available = Sum of Optimal Individual Allocations'</span>)</a>
<a class="sourceLine" id="cb128-5" title="5">  <span class="kw"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">'fl_N_agg ='</span>, fl_N_agg, <span class="st">', and, sum(df_bisec_dtgch_cbem4 %&gt;% pull(svr_root_x))='</span>, fl_allocated)</a>
<a class="sourceLine" id="cb128-6" title="6">} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb128-7" title="7">  <span class="kw"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">'fl_N_agg ='</span>, fl_N_agg, <span class="st">', but, sum(df_bisec_dtgch_cbem4 %&gt;% pull(svr_root_x))='</span>, fl_allocated)</a>
<a class="sourceLine" id="cb128-8" title="8">}</a></code></pre></div>
<pre><code>## fl_N_agg = 100 , but, sum(df_bisec_dtgch_cbem4 %&gt;% pull(svr_root_x))= 100</code></pre>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb130-1" title="1">df_bisec_dtgch_cbem4</a></code></pre></div>
<pre><code>## # A tibble: 9 x 10
##   INDI_ID  fl_A fl_alpha     x       fx f_p_t_f_a bisec_a_27 bisec_b_27
##     &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
## 1       2  4.34  0.00669  7.64 -1.35e-5 -8.09e-11       7.64       7.64
## 2       3  4.36  0.00925 10.6   4.08e-6  7.39e-11      10.6       10.6 
## 3       4  4.35  0.00925 10.6   8.10e-6  1.80e-10      10.6       10.6 
## 4       5  4.37  0.0139  16.1  -5.42e-7 -4.72e-12      16.1       16.1 
## 5       6  4.34  0.00669  7.63 -1.78e-5 -3.08e-11       7.63       7.63
## 6       7  4.36  0.0139  16.1   5.60e-6  8.34e-11      16.1       16.1 
## 7       8  4.34  0.00669  7.63 -1.17e-5 -9.18e-11       7.63       7.63
## 8       9  4.34  0.00669  7.63  1.56e-5  5.49e-10       7.63       7.63
## 9      10  4.36  0.0139  16.1   9.17e-6  1.69e-10      16.1       16.1 
## # … with 2 more variables: bisec_fa_27 &lt;dbl&gt;, bisec_fb_27 &lt;dbl&gt;</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#objective">Objective</a><ul class="nav nav-pills nav-stacked">
<li><a href="#bisection-algorithm">Bisection Algorithm</a></li>
      </ul>
</li>
      <li>
<a href="#set-up-for-implementation">Set up for Implementation</a><ul class="nav nav-pills nav-stacked">
<li><a href="#load-packages">Load Packages</a></li>
      <li><a href="#set-up-input-arrays">Set up Input Arrays</a></li>
      <li><a href="#create-nonlinear-root-function">Create Nonlinear Root Function</a></li>
      </ul>
</li>
      <li>
<a href="#step-by-step-implmentation-of-algorithm">Step by Step Implmentation of Algorithm</a><ul class="nav nav-pills nav-stacked">
<li><a href="#initialize-matrix">Initialize Matrix</a></li>
      <li><a href="#iterate-and-solve-for-fp-update-fa-and-fb">Iterate and Solve for f(p), update f(a) and f(b)</a></li>
      <li><a href="#reshape-wide-to-long-to-wide">Reshape Wide to long to Wide</a></li>
      <li><a href="#graph-bisection-iteration-results">Graph Bisection Iteration Results</a></li>
      </ul>
</li>
      <li>
<a href="#implement-bisection-as-a-function-over-dataframe">Implement Bisection as A Function over Dataframe</a><ul class="nav nav-pills nav-stacked">
<li><a href="#define-bisection-algorithm-function">Define Bisection Algorithm Function</a></li>
      <li><a href="#prepare-inputs-to-invoke-bisection-function">Prepare Inputs to Invoke Bisection Function</a></li>
      <li><a href="#test-function">Test Function</a></li>
      <li><a href="#test-with-prjoptialloc-log-results">Test with PrjOptiAlloc log results</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Fan Wang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
